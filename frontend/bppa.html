<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BPPA Dashboard - Taxparency</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1><a href="index.html" style="color: white; text-decoration: none;">üîç Taxparency</a></h1>
                <p class="tagline">BPPA (Procurement Authority) Dashboard</p>
            </div>
            <div class="blockchain-status">
                <div class="status-indicator" id="blockchainStatus">
                    <span class="status-dot"></span>
                    <span class="status-text">Connecting...</span>
                </div>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div class="hero">
                <h2>Welcome, BPPA Official</h2>
                <p class="hero-description">
                    As a Bureau of Public Procurement Authority official, you manage the transparent procurement process. 
                    Create tenders, evaluate proposals, finalize vendors, and initiate projects.
                    All procurement decisions are recorded immutably for public accountability.
                </p>
            </div>

            <!-- Dashboard Stats -->
            <section class="stats-overview">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalTenders">Loading...</div>
                        <div class="stat-label">Total Tenders Created</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeTenders">Loading...</div>
                        <div class="stat-label">Active Tenders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalProposals">Loading...</div>
                        <div class="stat-label">Total Proposals Received</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeProjects">Loading...</div>
                        <div class="stat-label">Active Projects</div>
                    </div>
                </div>
            </section>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 3rem;">
                
                <!-- Create New Tender -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Create New Tender</h3>
                    </div>
                    <div class="card-body">
                        <form id="tenderCreationForm">
                            <div class="form-group">
                                <label class="form-label" for="tenderTitle">Tender Title</label>
                                <input type="text" 
                                       id="tenderTitle" 
                                       class="form-input" 
                                       placeholder="e.g., Road Construction Project" 
                                       required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="tenderAmount">Budget Amount (ETH)</label>
                                <input type="number" 
                                       id="tenderAmount" 
                                       class="form-input" 
                                       step="0.01" 
                                       min="0.01"
                                       placeholder="10.0"
                                       required>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="tenderDeadline">Submission Deadline</label>
                                <input type="datetime-local" 
                                       id="tenderDeadline" 
                                       class="form-input" 
                                       required>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="evaluationType">Evaluation Method</label>
                                <select id="evaluationType" class="form-input" required>
                                    <option value="0">L1 (Lowest Price)</option>
                                    <option value="1">QCBS (Quality & Cost Based)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="tenderDescription">Description Documents</label>
                                <input type="file" 
                                       id="tenderDescription" 
                                       class="form-input" 
                                       accept=".pdf,.doc,.docx" 
                                       multiple>
                                <small style="color: var(--text-secondary); font-size: 0.875rem;">
                                    Upload tender specifications, requirements, and drawings
                                </small>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" id="createTenderBtn">
                                Create Tender
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Procurement Overview -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Procurement Overview</h3>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="flex justify-between mb-2">
                                <span>Available Budget:</span>
                                <span id="availableBudget">Loading...</span>
                            </div>
                            <div class="flex justify-between mb-2">
                                <span>Allocated Budget:</span>
                                <span id="allocatedBudget">Loading...</span>
                            </div>
                            <div class="flex justify-between mb-2">
                                <span>Remaining Budget:</span>
                                <span id="remainingBudget">Loading...</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Budget Utilization:</span>
                                <span id="budgetUtilization">Loading...</span>
                            </div>
                        </div>
                        
                        <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem;">
                            <h4 style="margin-bottom: 0.5rem; font-size: 1rem;">BPPA Authority:</h4>
                            <ul style="font-size: 0.875rem; color: var(--text-secondary);">
                                <li>‚úì Create transparent tenders</li>
                                <li>‚úì Evaluate vendor proposals</li>
                                <li>‚úì Finalize winning vendors</li>
                                <li>‚úì Monitor project progress</li>
                            </ul>
                        </div>

                        <div class="flex flex-col gap-2">
                            <button class="btn btn-secondary" onclick="scrollToSection('manageTenders')">
                                üìã Manage Tenders
                            </button>
                            <button class="btn btn-secondary" onclick="scrollToSection('projectTracking')">
                                üèóÔ∏è Track Projects
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Manage Tenders -->
            <section class="mb-4" id="manageTenders">
                <h3 class="mb-3">Tender Management</h3>
                <div id="tendersList" class="loading">
                    Loading your tenders...
                </div>
            </section>

            <!-- Project Tracking -->
            <section class="mb-4" id="projectTracking">
                <h3 class="mb-3">Active Projects</h3>
                <div id="activeProjectsList" class="loading">
                    Loading active projects...
                </div>
            </section>

        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>BPPA Authority</h4>
                    <p>The Bureau of Public Procurement Authority ensures fair, transparent, and efficient government procurement processes.</p>
                </div>
                <div class="footer-section">
                    <h4>Procurement Principles</h4>
                    <ul>
                        <li>Transparency in all processes</li>
                        <li>Fair competition among vendors</li>
                        <li>Value for money principles</li>
                        <li>Accountability and audit trails</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Public Trust</h4>
                    <p>All procurement decisions are recorded on the blockchain, ensuring complete transparency and public accountability.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Tender Details Modal -->
    <div id="tenderModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Tender Management</h3>
                </div>
                <div class="card-body">
                    <div id="tenderDetails">
                        <!-- Details will be populated here -->
                    </div>
                    
                    <div id="tenderActions" class="mt-3">
                        <!-- Actions will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Creation Modal -->
    <div id="projectModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Create Project</h3>
                </div>
                <div class="card-body">
                    <form id="projectCreationForm">
                        <div id="projectFormDetails">
                            <!-- Form details will be populated here -->
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="projectTitle">Project Title</label>
                            <input type="text" id="projectTitle" class="form-input" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="expectedEndDate">Expected End Date</label>
                            <input type="date" id="expectedEndDate" class="form-input" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="projectDescriptionDocs">Project Description Documents</label>
                            <input type="file" 
                                   id="projectDescriptionDocs" 
                                   class="form-input" 
                                   accept=".pdf,.doc,.docx" 
                                   multiple>
                        </div>
                        
                        <div class="flex gap-2">
                            <button type="submit" class="btn btn-primary">Create Project</button>
                            <button type="button" class="btn btn-secondary" onclick="closeProjectModal()">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.6.0/dist/ethers.umd.min.js"></script>
    <script src="js/web3-init.js"></script>
    <script src="js/contract-calls.js"></script>
    <script>
        let userAddress = null;
        let currentTenderId = null;
        let selectedVendorId = null;
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                await initializeWeb3();
                userAddress = await window.signer.getAddress();
                
                await loadDashboardData();
                await loadTenders();
                await loadActiveProjects();
                
                setupEventListeners();
            } catch (error) {
                console.error('Initialization error:', error);
                updateConnectionStatus('disconnected', 'Connection Failed');
            }
        });

        async function loadDashboardData() {
            try {
                // Load budget information
                const budgetSummary = await getBudgetSummary();
                document.getElementById('availableBudget').textContent = 
                    formatEther(budgetSummary.currentBalance) + ' ETH';
                
                // Calculate allocated budget (this would need contract enhancement)
                document.getElementById('allocatedBudget').textContent = 
                    formatEther(budgetSummary.totalDeducted) + ' ETH';
                
                document.getElementById('remainingBudget').textContent = 
                    formatEther(budgetSummary.currentBalance) + ' ETH';

                // Calculate utilization percentage
                const utilization = budgetSummary.validatedRevenue.gt(0) ? 
                    (budgetSummary.totalDeducted.mul(100).div(budgetSummary.validatedRevenue)).toString() + '%' : '0%';
                document.getElementById('budgetUtilization').textContent = utilization;

                // Load tender statistics
                const activeTenderIds = await getActiveTenders();
                document.getElementById('activeTenders').textContent = activeTenderIds.length;

                // Load project statistics
                const activeProjectIds = await getActiveProjects();
                document.getElementById('activeProjects').textContent = activeProjectIds.length;

                // Placeholder for total tenders and proposals (would need contract enhancement)
                document.getElementById('totalTenders').textContent = 'Loading...';
                document.getElementById('totalProposals').textContent = 'Loading...';

            } catch (error) {
                console.error('Error loading dashboard data:', error);
                // Set error states
                document.getElementById('availableBudget').textContent = 'Error';
                document.getElementById('allocatedBudget').textContent = 'Error';
                document.getElementById('remainingBudget').textContent = 'Error';
            }
        }

        async function loadTenders() {
            try {
                const tenderIds = await getActiveTenders();
                const container = document.getElementById('tendersList');
                
                if (tenderIds.length === 0) {
                    container.innerHTML = `
                        <div class="card">
                            <div class="card-body text-center">
                                <h4>No Tenders Created Yet</h4>
                                <p>Create your first tender using the form above to start the procurement process.</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                const tenders = await Promise.all(
                    tenderIds.map(id => loadTenderWithDetails(id))
                );

                container.innerHTML = tenders.map(tender => {
                    const timeLeft = new Date(tender.deadline * 1000) - new Date();
                    const daysLeft = Math.ceil(timeLeft / (1000 * 60 * 60 * 24));
                    
                    return `
                        <div class="card mb-3">
                            <div class="card-header">
                                <div class="flex justify-between items-center">
                                    <h4 class="card-title">Tender #${tender.id}: ${tender.title}</h4>
                                    <div class="flex gap-2">
                                        <span class="badge badge-info">${formatEvaluationType(tender.evaluationType)}</span>
                                        <span class="badge ${getStatusBadgeClass(tender.status)}">${formatTenderStatus(tender.status)}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="grid grid-cols-2 gap-4 mb-3">
                                    <div>
                                        <strong>Budget:</strong> ${formatEther(tender.amount)} ETH
                                    </div>
                                    <div>
                                        <strong>Deadline:</strong> ${formatTimestamp(tender.deadline)}
                                    </div>
                                    <div>
                                        <strong>Proposals:</strong> ${tender.proposals.length}
                                    </div>
                                    <div>
                                        <strong>Days Left:</strong> ${daysLeft > 0 ? daysLeft + ' days' : 'Expired'}
                                    </div>
                                </div>
                                
                                <div class="text-center">
                                    <button class="btn btn-primary" onclick="openTenderModal(${tender.id})">
                                        Manage Tender
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading tenders:', error);
                document.getElementById('tendersList').innerHTML = 
                    '<div class="error">Error loading tenders</div>';
            }
        }

        async function loadActiveProjects() {
            try {
                const projectIds = await getActiveProjects();
                const container = document.getElementById('activeProjectsList');
                
                if (projectIds.length === 0) {
                    container.innerHTML = `
                        <div class="card">
                            <div class="card-body text-center">
                                <h4>No Active Projects</h4>
                                <p>Projects will appear here once tenders are finalized and projects are created.</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                const projects = await Promise.all(
                    projectIds.map(id => loadProjectWithUpdates(id))
                );

                container.innerHTML = projects.map(project => `
                    <div class="card mb-3">
                        <div class="card-header">
                            <div class="flex justify-between items-center">
                                <h4 class="card-title">Project #${project.id}: ${project.title}</h4>
                                <span class="badge ${getProjectStatusBadgeClass(project.status)}">${formatProjectStatus(project.status)}</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="grid grid-cols-2 gap-4 mb-3">
                                <div>
                                    <strong>Budget:</strong> ${formatEther(project.budget)} ETH
                                </div>
                                <div>
                                    <strong>Start Date:</strong> ${formatTimestamp(project.startDate)}
                                </div>
                                <div>
                                    <strong>Expected End:</strong> ${formatTimestamp(project.expectedEndDate)}
                                </div>
                                <div>
                                    <strong>Updates:</strong> ${project.updates.length}
                                </div>
                            </div>
                            
                            <div class="text-center">
                                <button class="btn btn-secondary" onclick="viewProject(${project.id})">
                                    View Project Details
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Error loading active projects:', error);
                document.getElementById('activeProjectsList').innerHTML = 
                    '<div class="error">Error loading projects</div>';
            }
        }

        function setupEventListeners() {
            // Tender creation form
            document.getElementById('tenderCreationForm').addEventListener('submit', handleTenderCreation);
            
            // Project creation form
            document.getElementById('projectCreationForm').addEventListener('submit', handleProjectCreation);
        }

        async function handleTenderCreation(event) {
            event.preventDefault();
            
            const createBtn = document.getElementById('createTenderBtn');
            const originalText = createBtn.textContent;
            
            try {
                createBtn.disabled = true;
                createBtn.textContent = 'Creating...';
                
                const title = document.getElementById('tenderTitle').value;
                const amount = document.getElementById('tenderAmount').value;
                const deadline = document.getElementById('tenderDeadline').value;
                const evaluationType = document.getElementById('evaluationType').value;
                const descriptionFiles = document.getElementById('tenderDescription').files;
                
                // In a real implementation, upload description documents to IPFS
                const descriptionHash = generateIPFSHash('tender-description-' + Date.now());
                
                await createTender(title, amount, deadline, parseInt(evaluationType), descriptionHash);
                
                // Show success message
                alert('Tender created successfully! It is now open for vendor proposals.');
                
                // Reset form and reload data
                document.getElementById('tenderCreationForm').reset();
                await loadDashboardData();
                await loadTenders();
                
            } catch (error) {
                console.error('Error creating tender:', error);
                alert('Error creating tender: ' + error.message);
            } finally {
                createBtn.disabled = false;
                createBtn.textContent = originalText;
            }
        }

        async function openTenderModal(tenderId) {
            try {
                currentTenderId = tenderId;
                const tender = await loadTenderWithDetails(tenderId);
                
                const modal = document.getElementById('tenderModal');
                const detailsContainer = document.getElementById('tenderDetails');
                const actionsContainer = document.getElementById('tenderActions');
                
                detailsContainer.innerHTML = `
                    <div class="mb-4">
                        <h4>Tender #${tender.id}: ${tender.title}</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div><strong>Budget:</strong> ${formatEther(tender.amount)} ETH</div>
                            <div><strong>Status:</strong> <span class="badge ${getStatusBadgeClass(tender.status)}">${formatTenderStatus(tender.status)}</span></div>
                            <div><strong>Evaluation:</strong> ${formatEvaluationType(tender.evaluationType)}</div>
                            <div><strong>Deadline:</strong> ${formatTimestamp(tender.deadline)}</div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h5>Received Proposals (${tender.proposals.length})</h5>
                        ${tender.proposals.length > 0 ? `
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Vendor</th>
                                            <th>Cost (ETH)</th>
                                            <th>Citizen Votes</th>
                                            <th>Technical Score</th>
                                            <th>Evaluated</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${tender.proposals.map(proposal => `
                                            <tr>
                                                <td>${proposal.vendor.name}</td>
                                                <td>${formatEther(proposal.cost)}</td>
                                                <td>${proposal.votes}</td>
                                                <td>${proposal.technicalScore || 'Not scored'}</td>
                                                <td>${proposal.evaluated ? 'Yes' : 'No'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        ` : '<p>No proposals received yet.</p>'}
                    </div>
                `;

                // Generate action buttons based on tender status
                let actionButtons = '';
                
                if (tender.status === 0) { // Open
                    actionButtons = `
                        <button class="btn btn-warning" onclick="closeTenderForVoting()">
                            Close for Voting
                        </button>
                    `;
                } else if (tender.status === 1) { // Closed for voting
                    if (tender.proposals.length > 0) {
                        actionButtons = `
                            <div class="mb-3">
                                <label class="form-label">Select Winning Vendor:</label>
                                <select id="vendorSelect" class="form-input">
                                    <option value="">Choose vendor...</option>
                                    ${tender.proposals.map(proposal => `
                                        <option value="${proposal.vendorId}">
                                            ${proposal.vendor.name} - ${formatEther(proposal.cost)} ETH (${proposal.votes} votes)
                                        </option>
                                    `).join('')}
                                </select>
                            </div>
                            <button class="btn btn-success" onclick="finalizeSelectedVendor()">
                                Finalize Vendor
                            </button>
                        `;
                    }
                } else if (tender.status === 2) { // Finalized
                    const winningProposal = tender.proposals.find(p => p.vendorId == tender.selectedVendorId);
                    actionButtons = `
                        <div style="background: var(--success-bg); color: var(--success-color); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem;">
                            <strong>‚úì Tender Finalized</strong><br>
                            Winner: ${winningProposal ? winningProposal.vendor.name : 'Unknown'}<br>
                            Cost: ${winningProposal ? formatEther(winningProposal.cost) + ' ETH' : 'Unknown'}
                        </div>
                        <button class="btn btn-primary" onclick="createProjectFromTender()">
                            Create Project
                        </button>
                    `;
                }

                actionButtons += `
                    <button class="btn btn-secondary ml-2" onclick="closeTenderModal()">
                        Close
                    </button>
                `;

                actionsContainer.innerHTML = actionButtons;
                modal.style.display = 'flex';
                
            } catch (error) {
                console.error('Error opening tender modal:', error);
                alert('Error loading tender details: ' + error.message);
            }
        }

        function closeTenderModal() {
            document.getElementById('tenderModal').style.display = 'none';
            currentTenderId = null;
            selectedVendorId = null;
        }

        async function closeTenderForVoting() {
            // In the current contract structure, this is handled automatically
            // This would be a placeholder for extending functionality
            alert('Tenders automatically close after deadline. This feature would extend the contract to allow manual closure.');
        }

        async function finalizeSelectedVendor() {
            const vendorSelect = document.getElementById('vendorSelect');
            selectedVendorId = vendorSelect.value;
            
            if (!selectedVendorId) {
                alert('Please select a vendor first.');
                return;
            }

            try {
                await finalizeVendor(currentTenderId, selectedVendorId);
                alert('Vendor finalized successfully! You can now create a project.');
                
                closeTenderModal();
                await loadTenders();
                await loadDashboardData();
                
            } catch (error) {
                console.error('Error finalizing vendor:', error);
                alert('Error finalizing vendor: ' + error.message);
            }
        }

        async function createProjectFromTender() {
            try {
                const tender = await getTender(currentTenderId);
                const winningVendor = await getVendor(tender.selectedVendorId);
                
                // Open project creation modal with pre-filled data
                const modal = document.getElementById('projectModal');
                const formDetails = document.getElementById('projectFormDetails');
                
                formDetails.innerHTML = `
                    <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem;">
                        <h5>Project Details from Tender #${tender.id}</h5>
                        <div class="grid grid-cols-2 gap-4">
                            <div><strong>Tender:</strong> ${tender.title}</div>
                            <div><strong>Budget:</strong> ${formatEther(tender.amount)} ETH</div>
                            <div><strong>Vendor:</strong> ${winningVendor.name}</div>
                            <div><strong>Vendor ID:</strong> ${tender.selectedVendorId}</div>
                        </div>
                    </div>
                `;
                
                // Pre-fill project title
                document.getElementById('projectTitle').value = tender.title + ' - Implementation';
                
                modal.style.display = 'flex';
                
            } catch (error) {
                console.error('Error preparing project creation:', error);
                alert('Error preparing project creation: ' + error.message);
            }
        }

        function closeProjectModal() {
            document.getElementById('projectModal').style.display = 'none';
        }

        async function handleProjectCreation(event) {
            event.preventDefault();
            
            if (!currentTenderId) {
                alert('No tender selected for project creation.');
                return;
            }

            try {
                const tender = await getTender(currentTenderId);
                const projectTitle = document.getElementById('projectTitle').value;
                const expectedEndDate = document.getElementById('expectedEndDate').value;
                const descriptionFiles = document.getElementById('projectDescriptionDocs').files;
                
                // In a real implementation, upload description documents to IPFS
                const descriptionHash = generateIPFSHash('project-description-' + Date.now());
                
                await createProject(
                    currentTenderId,
                    tender.selectedVendorId,
                    formatEther(tender.amount), // This should stay in wei for the contract
                    expectedEndDate,
                    projectTitle,
                    descriptionHash
                );
                
                alert('Project created successfully! Vendor can now start work and post updates.');
                
                closeProjectModal();
                closeTenderModal();
                
                // Reload data
                await loadDashboardData();
                await loadActiveProjects();
                
            } catch (error) {
                console.error('Error creating project:', error);
                alert('Error creating project: ' + error.message);
            }
        }

        function viewProject(projectId) {
            // In a real implementation, this would open a detailed project view
            alert(`Project #${projectId} details would be displayed here, including all updates, milestones, and vendor progress.`);
        }

        // Helper functions
        function getStatusBadgeClass(status) {
            const classMap = {
                0: 'badge-success',
                1: 'badge-warning', 
                2: 'badge-info'
            };
            return classMap[status] || 'badge-secondary';
        }

        function getProjectStatusBadgeClass(status) {
            const classMap = {
                0: 'badge-info',    // Active
                1: 'badge-success', // Completed
                2: 'badge-warning', // Delayed
                3: 'badge-danger'   // Flagged
            };
            return classMap[status] || 'badge-secondary';
        }

        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        // Set minimum datetime for deadline to current time
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('tenderDeadline').min = now.toISOString().slice(0,16);
        });
    </script>

    <style>
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .grid {
            display: grid;
        }
        
        .grid-cols-2 {
            grid-template-columns: 1fr 1fr;
        }
        
        .gap-4 {
            gap: 1rem;
        }
        
        .ml-2 {
            margin-left: 0.5rem;
        }
        
        .mt-3 {
            margin-top: 1rem;
        }
    </style>
</body>
</html>
